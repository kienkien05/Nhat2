<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App H·ªçc T·ª´ V·ª±ng Ti·∫øng Nh·∫≠t</title>
    <style>
        /* CSS Clean & Modern */
        :root {
            --primary-color: #4a90e2;
            --success-color: #2ecc71;
            --error-color: #e74c3c;
            --bg-color: #f5f7fa;
            --card-bg: #ffffff;
            --text-color: #2c3e50;
        }

        body {
            font-family: 'Segoe UI', 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            background: var(--card-bg);
            width: 90%;
            max-width: 500px;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        h1,
        h2 {
            margin: 0 0 1rem 0;
            color: #34495e;
        }

        /* Screens */
        .screen {
            display: none;
        }

        .screen.active {
            display: block;
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Buttons */
        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.2s;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(74, 144, 226, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background-color: #95a5a6;
        }

        .btn-topic {
            width: 100%;
            margin-bottom: 10px;
            text-align: left;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn-topic:hover {
            background-color: #357abd;
        }

        /* Quiz UI */
        .stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 0.95rem;
            color: #7f8c8d;
            font-weight: 500;
        }

        .question-box {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary-color);
            margin: 30px 0;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .option-btn {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            color: var(--text-color);
            padding: 15px;
            border-radius: 10px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .option-btn:hover {
            border-color: var(--primary-color);
            background: #eef4fb;
        }

        .option-btn.correct {
            background-color: var(--success-color) !important;
            color: white !important;
            border-color: var(--success-color) !important;
        }

        .option-btn.wrong {
            background-color: var(--error-color) !important;
            color: white !important;
            border-color: var(--error-color) !important;
        }

        .controls {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        /* Result Screen */
        .score-big {
            font-size: 4rem;
            font-weight: bold;
            color: var(--primary-color);
            margin: 20px 0;
        }

        .score-text {
            font-size: 1.2rem;
            color: #7f8c8d;
        }
    </style>
</head>

<body>

    <div class="container">
        <!-- SCREEN 1: TOPIC SELECTION -->
        <div id="screen-topics" class="screen active">
            <h2>Ch·ªçn Ch·ªß ƒê·ªÅ</h2>
            <div style="margin-bottom: 20px;">
                <label style="margin-right: 15px;">
                    <input type="radio" name="lang-mode" value="vn_jp" checked> Vi·ªát ‚Üí Nh·∫≠t
                </label>
                <label>
                    <input type="radio" name="lang-mode" value="jp_vn"> Nh·∫≠t ‚Üí Vi·ªát
                </label>
            </div>
            <div id="topics-list">
                <!-- Topics will be inserted here -->
            </div>
        </div>

        <!-- SCREEN 2: QUIZ -->
        <div id="screen-quiz" class="screen">
            <div class="stats">
                <span id="score-display">ƒêi·ªÉm: 0</span>
                <span id="progress-display">C√¢u: 1/10</span>
            </div>

            <div class="question-box" id="question-text">
                Loading...
            </div>

            <div class="options-grid" id="options-container">
                <!-- Options -->
            </div>

            <div class="controls">
                <button id="btn-home" class="btn btn-secondary" onclick="showTopics()">üè† Home</button>
                <button id="btn-next" class="btn" onclick="nextQuestion()" style="display: none;">C√¢u ti·∫øp ‚û°</button>
            </div>
        </div>

        <!-- SCREEN 3: RESULTS -->
        <div id="screen-result" class="screen">
            <h2>K·∫øt Th√∫c!</h2>
            <div class="score-text">S·ªë ƒëi·ªÉm c·ªßa b·∫°n</div>
            <div class="score-big" id="final-score">0</div>
            <p id="final-msg">L√†m t·ªët l·∫Øm!</p>
            <button class="btn" onclick="showTopics()">Ch∆°i l·∫°i</button>
        </div>
    </div>

    <script>
        // --- DATA ---
        const rawData = [
            // --- B√ÄI 1 (1-A: Di chuy·ªÉn, 1-B: Ng√†y l·ªÖ & Th·ªùi gian) ---
            { "id": "v101", "hiragana": "„ÅÑ„Åç„Åæ„Åô", "meaning": "ƒëi", "lesson": 1 },
            { "id": "v102", "hiragana": "„Åç„Åæ„Åô", "meaning": "ƒë·∫øn", "lesson": 1 },
            { "id": "v103", "hiragana": "„Åã„Åà„Çä„Åæ„Åô", "meaning": "tr·ªü v·ªÅ", "lesson": 1 },
            { "id": "v104", "hiragana": "„Å≤„Åì„ÅÜ„Åç", "meaning": "m√°y bay", "lesson": 1 },
            { "id": "v105", "hiragana": "„Çø„ÇØ„Ç∑„Éº", "meaning": "xe taxi", "lesson": 1 },
            { "id": "v106", "hiragana": "„Éê„Çπ", "meaning": "xe bu√Ωt", "lesson": 1 },
            { "id": "v107", "hiragana": "„Åò„Å¶„Çì„Åó„ÇÉ", "meaning": "xe ƒë·∫°p", "lesson": 1 },
            { "id": "v108", "hiragana": "„ÅÇ„Çã„ÅÑ„Å¶", "meaning": "ƒëi b·ªô", "lesson": 1 },
            { "id": "v109", "hiragana": "„Éê„Ç§„ÇØ", "meaning": "xe m√°y", "lesson": 1 },
            { "id": "v110", "hiragana": "„Å®„ÇÇ„Å†„Å°", "meaning": "b·∫°n b√®", "lesson": 1 },
            { "id": "v111", "hiragana": "„Åì„ÅÑ„Å≥„Å®", "meaning": "ng∆∞·ªùi y√™u", "lesson": 1 },
            { "id": "v112", "hiragana": "„Åã„Åû„Åè", "meaning": "gia ƒë√¨nh", "lesson": 1 },
            { "id": "v113", "hiragana": "„Å≤„Å®„Çä„Åß", "meaning": "m·ªôt m√¨nh", "lesson": 1 },
            { "id": "v114", "hiragana": "„Åü„Çì„Åò„Çá„ÅÜ„Å≥", "meaning": "sinh nh·∫≠t", "lesson": 1 },
            { "id": "v115", "hiragana": "„Åì„Å©„ÇÇ„ÅÆ„Å≤", "meaning": "t·∫øt thi·∫øu nhi", "lesson": 1 },
            { "id": "v116", "hiragana": "„Åõ„Çì„Åõ„ÅÑ„ÅÆ„Å≤", "meaning": "ng√†y nh√† gi√°o", "lesson": 1 },
            { "id": "v117", "hiragana": "„ÇØ„É™„Çπ„Éû„Çπ", "meaning": "gi√°ng sinh (Noel)", "lesson": 1 },
            { "id": "v118", "hiragana": "„Åò„Çá„Åõ„ÅÑ„ÅÆ„Å≤", "meaning": "ng√†y ph·ª• n·ªØ", "lesson": 1 },
            { "id": "v119", "hiragana": "„Éê„É¨„É≥„Çø„Ç§„É≥„Éá„Éº", "meaning": "ng√†y Valentine", "lesson": 1 },
            { "id": "v120", "hiragana": "„Å™„Çì„Åå„Å§", "meaning": "th√°ng m·∫•y", "lesson": 1 },
            { "id": "v121", "hiragana": "„Å™„Çì„Å´„Å°", "meaning": "ng√†y m·∫•y", "lesson": 1 },
            { "id": "v122", "hiragana": "„ÅÑ„Å§", "meaning": "khi n√†o", "lesson": 1 },

            // --- B√ÄI 2 (2-A: ƒÇn u·ªëng, 2-B: Ho·∫°t ƒë·ªông gi·∫£i tr√≠) ---
            { "id": "v201", "hiragana": "„Åü„Åπ„Åæ„Åô", "meaning": "ƒÉn", "lesson": 2 },
            { "id": "v202", "hiragana": "„ÅÆ„Åø„Åæ„Åô", "meaning": "u·ªëng", "lesson": 2 },
            { "id": "v203", "hiragana": "„Åø„Åæ„Åô", "meaning": "xem", "lesson": 2 },
            { "id": "v204", "hiragana": "„Çà„Åø„Åæ„Åô", "meaning": "ƒë·ªçc", "lesson": 2 },
            { "id": "v205", "hiragana": "„Åã„Åç„Åæ„Åô", "meaning": "vi·∫øt", "lesson": 2 },
            { "id": "v206", "hiragana": "„Åã„ÅÑ„Åæ„Åô", "meaning": "mua", "lesson": 2 },
            { "id": "v207", "hiragana": "„Åî„ÅØ„Çì", "meaning": "c∆°m", "lesson": 2 },
            { "id": "v208", "hiragana": "„Éë„É≥", "meaning": "b√°nh m√¨", "lesson": 2 },
            { "id": "v209", "hiragana": "„Å´„Åè", "meaning": "th·ªãt", "lesson": 2 },
            { "id": "v210", "hiragana": "„Åï„Åã„Å™", "meaning": "c√°", "lesson": 2 },
            { "id": "v211", "hiragana": "„Åø„Åö", "meaning": "n∆∞·ªõc", "lesson": 2 },
            { "id": "v212", "hiragana": "„Åä„Å°„ÇÉ", "meaning": "tr√†", "lesson": 2 },
            { "id": "v213", "hiragana": "„Éü„É´„ÇØ", "meaning": "s·ªØa", "lesson": 2 },
            { "id": "v214", "hiragana": "„Éì„Éº„É´", "meaning": "bia", "lesson": 2 },
            { "id": "v215", "hiragana": "„Åà„ÅÑ„Åå", "meaning": "phim", "lesson": 2 },
            { "id": "v216", "hiragana": "„Å¶„Åå„Åø", "meaning": "th∆∞", "lesson": 2 },
            { "id": "v217", "hiragana": "„Å™„Å´", "meaning": "c√°i g√¨", "lesson": 2 },
            { "id": "v218", "hiragana": "„ÅÇ„ÅÑ„Åæ„Åô", "meaning": "g·∫∑p (b·∫°n)", "lesson": 2 },
            { "id": "v219", "hiragana": "„Åô„ÅÑ„Åæ„Åô", "meaning": "h√∫t (thu·ªëc)", "lesson": 2 },
            { "id": "v220", "hiragana": "„Åó„Åæ„Åô", "meaning": "l√†m / ch∆°i (th·ªÉ thao)", "lesson": 2 },
            { "id": "v221", "hiragana": "„É¨„Çπ„Éà„É©„É≥", "meaning": "nh√† h√†ng", "lesson": 2 },
            { "id": "v222", "hiragana": "„Åà„ÅÑ„Åå„Åã„Çì", "meaning": "r·∫°p chi·∫øu phim", "lesson": 2 },
            { "id": "v223", "hiragana": "„Åä„Åï„Åë", "meaning": "r∆∞·ª£u", "lesson": 2 },
            { "id": "v224", "hiragana": "„Åü„Å∞„Åì", "meaning": "thu·ªëc l√°", "lesson": 2 },
            { "id": "v225", "hiragana": "„Ç≥„Éº„Éí„Éº", "meaning": "c√† ph√™", "lesson": 2 },
            { "id": "v226", "hiragana": "„ÉÅ„Éß„Ç≥„É¨„Éº„Éà", "meaning": "s√¥ c√¥ la", "lesson": 2 },
            { "id": "v227", "hiragana": "„Ç¢„Ç§„Çπ„ÇØ„É™„Éº„É†", "meaning": "kem", "lesson": 2 },
            { "id": "v228", "hiragana": "„Å´„Å£„Åç", "meaning": "nh·∫≠t k√Ω", "lesson": 2 },
            { "id": "v229", "hiragana": "„Ç´„É©„Ç™„Ç±", "meaning": "h√°t karaoke", "lesson": 2 },
            { "id": "v230", "hiragana": "„Çµ„ÉÉ„Ç´„Éº", "meaning": "b√≥ng ƒë√°", "lesson": 2 },
            { "id": "v231", "hiragana": "„Åó„ÇÖ„Åè„Å†„ÅÑ", "meaning": "b√†i t·∫≠p", "lesson": 2 },
            { "id": "v232", "hiragana": "„Åä„ÅØ„Å™„Åø", "meaning": "ng·∫Øm hoa anh ƒë√†o", "lesson": 2 },
            { "id": "v233", "hiragana": "„Åù„Çå„Åã„Çâ", "meaning": "sau ƒë√≥", "lesson": 2 },
            { "id": "v234", "hiragana": "„ÅÑ„Å£„Åó„Çá„Å´", "meaning": "c√πng nhau", "lesson": 2 },

            // --- B√ÄI 3 (3-A: C√¥ng c·ª•, 3-B: Cho nh·∫≠n) ---
            { "id": "v301", "hiragana": "„Åä„Åè„Çä„Åæ„Åô", "meaning": "g·ª≠i", "lesson": 3 },
            { "id": "v302", "hiragana": "„Åç„Çä„Åæ„Åô", "meaning": "c·∫Øt, th√°i", "lesson": 3 },
            { "id": "v303", "hiragana": "„Å¶", "meaning": "tay", "lesson": 3 },
            { "id": "v304", "hiragana": "„ÅØ„Åó", "meaning": "ƒë≈©a", "lesson": 3 },
            { "id": "v305", "hiragana": "„Éä„Ç§„Éï", "meaning": "dao", "lesson": 3 },
            { "id": "v306", "hiragana": "„Éï„Ç©„Éº„ÇØ", "meaning": "dƒ©a", "lesson": 3 },
            { "id": "v307", "hiragana": "„ÅØ„Åï„Åø", "meaning": "k√©o", "lesson": 3 },
            { "id": "v308", "hiragana": "„Éï„Ç°„ÇØ„Çπ", "meaning": "m√°y fax", "lesson": 3 },
            { "id": "v309", "hiragana": "„Åë„Åó„Ç¥„É†", "meaning": "c·ª•c t·∫©y", "lesson": 3 },
            { "id": "v310", "hiragana": "„ÅØ„Å™", "meaning": "hoa", "lesson": 3 },
            { "id": "v311", "hiragana": "„É¨„Éù„Éº„Éà", "meaning": "b√°o c√°o", "lesson": 3 },
            { "id": "v312", "hiragana": "„Åë„ÅÑ„Åü„ÅÑ„Åß„Çì„Çè", "meaning": "ƒëi·ªán tho·∫°i di ƒë·ªông", "lesson": 3 },
            { "id": "v313", "hiragana": "„ÅÇ„Åí„Åæ„Åô", "meaning": "t·∫∑ng", "lesson": 3 },
            { "id": "v314", "hiragana": "„ÇÇ„Çâ„ÅÑ„Åæ„Åô", "meaning": "nh·∫≠n", "lesson": 3 },
            { "id": "v315", "hiragana": "„Åã„Åó„Åæ„Åô", "meaning": "cho m∆∞·ª£n", "lesson": 3 },
            { "id": "v316", "hiragana": "„Åã„Çä„Åæ„Åô", "meaning": "m∆∞·ª£n", "lesson": 3 },
            { "id": "v317", "hiragana": "„Åä„Åó„Åà„Åæ„Åô", "meaning": "d·∫°y", "lesson": 3 },
            { "id": "v318", "hiragana": "„Å™„Çâ„ÅÑ„Åæ„Åô", "meaning": "h·ªçc", "lesson": 3 },
            { "id": "v319", "hiragana": "„Åã„Åë„Åæ„Åô", "meaning": "g·ªçi (ƒëi·ªán tho·∫°i)", "lesson": 3 },
            { "id": "v320", "hiragana": "„Éó„É¨„Çº„É≥„Éà", "meaning": "qu√† t·∫∑ng", "lesson": 3 },
            { "id": "v321", "hiragana": "„ÅØ„Åå„Åç", "meaning": "b∆∞u thi·∫øp", "lesson": 3 },
            { "id": "v322", "hiragana": "„Ç∑„É£„ÉÑ", "meaning": "√°o s∆° mi", "lesson": 3 },
            { "id": "v323", "hiragana": "„Åï„ÅÑ„Åµ", "meaning": "c√°i v√≠", "lesson": 3 },
            { "id": "v324", "hiragana": "„Åä„Åã„Å≠", "meaning": "ti·ªÅn", "lesson": 3 },
            { "id": "v325", "hiragana": "„Å´„ÇÇ„Å§", "meaning": "h√†nh l√Ω", "lesson": 3 },
            { "id": "v326", "hiragana": "„ÉÅ„Ç±„ÉÉ„Éà", "meaning": "v√©", "lesson": 3 },
            { "id": "v327", "hiragana": "„Çä„Çá„ÅÜ„Åó„Çì", "meaning": "b·ªë m·∫π", "lesson": 3 },

            // --- B√ÄI 4 (4-A: T√≠nh t·ª´ i, 4-B: T√≠nh t·ª´ na, 4-C: S·ªü th√≠ch) ---
            { "id": "v401", "hiragana": "„ÅÑ„ÅÑ", "meaning": "t·ªët", "lesson": 4 },
            { "id": "v402", "hiragana": "„ÇÄ„Åö„Åã„Åó„ÅÑ", "meaning": "kh√≥", "lesson": 4 },
            { "id": "v403", "hiragana": "„ÇÑ„Åï„Åó„ÅÑ", "meaning": "d·ªÖ", "lesson": 4 },
            { "id": "v404", "hiragana": "„Åü„Åã„ÅÑ", "meaning": "ƒë·∫Øt / cao", "lesson": 4 },
            { "id": "v405", "hiragana": "„ÇÑ„Åô„ÅÑ", "meaning": "r·∫ª", "lesson": 4 },
            { "id": "v406", "hiragana": "„Åä„Åä„Åç„ÅÑ", "meaning": "to / l·ªõn", "lesson": 4 },
            { "id": "v407", "hiragana": "„Å°„ÅÑ„Åï„ÅÑ", "meaning": "nh·ªè", "lesson": 4 },
            { "id": "v408", "hiragana": "„ÅÑ„Åù„Åå„Åó„ÅÑ", "meaning": "b·∫≠n r·ªôn", "lesson": 4 },
            { "id": "v409", "hiragana": "„Åü„ÅÆ„Åó„ÅÑ", "meaning": "vui v·∫ª", "lesson": 4 },
            { "id": "v410", "hiragana": "„Åä„ÇÇ„Åó„Çç„ÅÑ", "meaning": "th√∫ v·ªã", "lesson": 4 },
            { "id": "v411", "hiragana": "„Åä„ÅÑ„Åó„ÅÑ", "meaning": "ngon", "lesson": 4 },
            { "id": "v412", "hiragana": "„ÇÇ„ÅÆ", "meaning": "ƒë·ªì v·∫≠t", "lesson": 4 },
            { "id": "v413", "hiragana": "„Åü„Åπ„ÇÇ„ÅÆ", "meaning": "ƒë·ªì ƒÉn", "lesson": 4 },
            { "id": "v414", "hiragana": "„Åπ„Çì„Åç„Çá„ÅÜ", "meaning": "vi·ªác h·ªçc", "lesson": 4 },
            { "id": "v415", "hiragana": "„Åè„Çã„Åæ", "meaning": "√¥ t√¥", "lesson": 4 },
            { "id": "v416", "hiragana": "„Å®„Å¶„ÇÇ", "meaning": "r·∫•t", "lesson": 4 },
            { "id": "v417", "hiragana": "„ÅÇ„Åæ„Çä", "meaning": "kh√¥ng... m·∫•y", "lesson": 4 },
            { "id": "v418", "hiragana": "„Éè„É≥„Çµ„É†", "meaning": "ƒë·∫πp trai", "lesson": 4 },
            { "id": "v419", "hiragana": "„Åç„Çå„ÅÑ", "meaning": "ƒë·∫πp / s·∫°ch", "lesson": 4 },
            { "id": "v420", "hiragana": "„Åó„Åö„Åã", "meaning": "y√™n tƒ©nh", "lesson": 4 },
            { "id": "v421", "hiragana": "„Å´„Åé„ÇÑ„Åã", "meaning": "n√°o nhi·ªát", "lesson": 4 },
            { "id": "v422", "hiragana": "„ÇÜ„ÅÜ„ÇÅ„ÅÑ", "meaning": "n·ªïi ti·∫øng", "lesson": 4 },
            { "id": "v423", "hiragana": "„Åó„Çì„Åõ„Å§", "meaning": "th√¢n thi·ªán / t·ªët b·ª•ng", "lesson": 4 },
            { "id": "v424", "hiragana": "„Åí„Çì„Åç", "meaning": "kh·ªèe m·∫°nh", "lesson": 4 },
            { "id": "v425", "hiragana": "„Å≤„Åæ", "meaning": "r·∫£nh r·ªói", "lesson": 4 },
            { "id": "v426", "hiragana": "„Åπ„Çì„Çä", "meaning": "ti·ªán l·ª£i", "lesson": 4 },
            { "id": "v427", "hiragana": "„Åï„Åè„Çâ", "meaning": "hoa anh ƒë√†o", "lesson": 4 },
            { "id": "v428", "hiragana": "„Éê„É©", "meaning": "hoa h·ªìng", "lesson": 4 },
            { "id": "v429", "hiragana": "„ÅØ„Åô", "meaning": "hoa sen", "lesson": 4 },
            { "id": "v430", "hiragana": "„Å≤„Å®", "meaning": "ng∆∞·ªùi", "lesson": 4 },
            { "id": "v431", "hiragana": "„Åæ„Å°", "meaning": "th√†nh ph·ªë", "lesson": 4 },
            { "id": "v432", "hiragana": "„Å®„Åì„Çç", "meaning": "n∆°i ch·ªën", "lesson": 4 },
            { "id": "v433", "hiragana": "„Å©„ÅÜ", "meaning": "th·∫ø n√†o", "lesson": 4 },
            { "id": "v434", "hiragana": "„Å©„Çì„Å™", "meaning": "nh∆∞ th·∫ø n√†o", "lesson": 4 },
            { "id": "v435", "hiragana": "„Åô„Åç", "meaning": "th√≠ch", "lesson": 4 },
            { "id": "v436", "hiragana": "„Åç„Çâ„ÅÑ", "meaning": "gh√©t", "lesson": 4 },
            { "id": "v437", "hiragana": "„Åò„Çá„ÅÜ„Åö", "meaning": "gi·ªèi", "lesson": 4 },
            { "id": "v438", "hiragana": "„Å∏„Åü", "meaning": "k√©m", "lesson": 4 },
            { "id": "v439", "hiragana": "„Çä„Çá„ÅÜ„Çä", "meaning": "vi·ªác n·∫•u ƒÉn / m√≥n ƒÉn", "lesson": 4 },
            { "id": "v440", "hiragana": "„ÅÆ„Åø„ÇÇ„ÅÆ", "meaning": "ƒë·ªì u·ªëng", "lesson": 4 },
            { "id": "v441", "hiragana": "„Çπ„Éù„Éº„ÉÑ", "meaning": "th·ªÉ thao", "lesson": 4 },
            { "id": "v442", "hiragana": "„ÉÜ„Éã„Çπ", "meaning": "tennis", "lesson": 4 },
            { "id": "v443", "hiragana": "„ÉÄ„É≥„Çπ", "meaning": "khi√™u v≈© / nh·∫£y", "lesson": 4 },
            { "id": "v444", "hiragana": "„Éö„ÉÉ„Éà", "meaning": "v·∫≠t nu√¥i", "lesson": 4 },
            { "id": "v445", "hiragana": "„ÅÑ„Å¨", "meaning": "con ch√≥", "lesson": 4 },
            { "id": "v446", "hiragana": "„Å≠„Åì", "meaning": "con m√®o", "lesson": 4 },
            { "id": "v447", "hiragana": "„ÅÜ„Åü", "meaning": "b√†i h√°t", "lesson": 4 },
            { "id": "v448", "hiragana": "„Åà", "meaning": "b·ª©c tranh", "lesson": 4 },
            { "id": "v449", "hiragana": "„Åò", "meaning": "ch·ªØ", "lesson": 4 },

            // --- B√ÄI 5 (5-A: V·ªã tr√≠ & T·ªìn t·∫°i, 5-B: S·ªü h·ªØu) ---
            { "id": "v501", "hiragana": "„ÅÑ„Åæ„Åô", "meaning": "c√≥ (ng∆∞·ªùi/v·∫≠t s·ªëng)", "lesson": 5 },
            { "id": "v502", "hiragana": "„ÅÇ„Çä„Åæ„Åô", "meaning": "c√≥ (ƒë·ªì v·∫≠t)", "lesson": 5 },
            { "id": "v503", "hiragana": "„Åä„Çì„Å™„ÅÆ„Åì", "meaning": "b√© g√°i", "lesson": 5 },
            { "id": "v504", "hiragana": "„Åä„Å®„Åì„ÅÆ„Åì", "meaning": "b√© trai", "lesson": 5 },
            { "id": "v505", "hiragana": "„Åç", "meaning": "c√°i c√¢y", "lesson": 5 },
            { "id": "v506", "hiragana": "„Åì„ÅÜ„Åà„Çì", "meaning": "c√¥ng vi√™n", "lesson": 5 },
            { "id": "v507", "hiragana": "„ÅÑ„Åë", "meaning": "c√°i ao", "lesson": 5 },
            { "id": "v508", "hiragana": "„ÅÜ„Åà", "meaning": "tr√™n", "lesson": 5 },
            { "id": "v509", "hiragana": "„Åó„Åü", "meaning": "d∆∞·ªõi", "lesson": 5 },
            { "id": "v510", "hiragana": "„Åæ„Åà", "meaning": "tr∆∞·ªõc", "lesson": 5 },
            { "id": "v511", "hiragana": "„ÅÜ„Åó„Çç", "meaning": "sau", "lesson": 5 },
            { "id": "v512", "hiragana": "„Å™„Åã", "meaning": "trong", "lesson": 5 },
            { "id": "v513", "hiragana": "„Åù„Å®", "meaning": "ngo√†i", "lesson": 5 },
            { "id": "v514", "hiragana": "„Å®„Å™„Çä", "meaning": "b√™n c·∫°nh", "lesson": 5 },
            { "id": "v515", "hiragana": "„Å°„Åã„Åè", "meaning": "g·∫ßn", "lesson": 5 },
            { "id": "v516", "hiragana": "„ÇÑ", "meaning": "...v√†... (li·ªát k√™)", "lesson": 5 },
            { "id": "v517", "hiragana": "„ÅÇ„Çä„Åæ„Åô", "meaning": "c√≥ (s·ªü h·ªØu)", "lesson": 5 },
            { "id": "v518", "hiragana": "„ÅØ„Åì", "meaning": "c√°i h·ªôp", "lesson": 5 },
            { "id": "v519", "hiragana": "„Çå„ÅÑ„Åû„ÅÜ„Åì", "meaning": "t·ªß l·∫°nh", "lesson": 5 },
            { "id": "v520", "hiragana": "„Åª„Çì„ÇÑ", "meaning": "hi·ªáu s√°ch", "lesson": 5 },
            { "id": "v521", "hiragana": "„Ç´„É¨„É≥„ÉÄ„Éº", "meaning": "l·ªãch", "lesson": 5 },
            { "id": "v522", "hiragana": "„Åó„ÇÉ„Åó„Çì", "meaning": "b·ª©c ·∫£nh", "lesson": 5 },
            { "id": "v523", "hiragana": "„Éô„ÉÉ„Éâ", "meaning": "c√°i gi∆∞·ªùng", "lesson": 5 },
            { "id": "v524", "hiragana": "„Åò„Åã„Çì", "meaning": "th·ªùi gian", "lesson": 5 },
            { "id": "v525", "hiragana": "„Çà„ÅÜ„Åò", "meaning": "vi·ªác b·∫≠n", "lesson": 5 },
            { "id": "v526", "hiragana": "„ÇÑ„Åè„Åù„Åè", "meaning": "l·ªùi h·ª©a", "lesson": 5 },
            { "id": "v527", "hiragana": "„Åü„Åè„Åï„Çì", "meaning": "nhi·ªÅu", "lesson": 5 },
            { "id": "v528", "hiragana": "„ÅØ„ÇÑ„Åè", "meaning": "s·ªõm / nhanh", "lesson": 5 },
            { "id": "v529", "hiragana": "„Å©„ÅÜ„Åó„Å¶", "meaning": "t·∫°i sao", "lesson": 5 },
            { "id": "v530", "hiragana": "„Åã„Çâ", "meaning": "b·ªüi v√¨", "lesson": 5 },

            // --- B√ÄI 6 (Th·ªùi ti·∫øt & So s√°nh) ---
            { "id": "v601", "hiragana": "„ÅÇ„Å§„ÅÑ", "meaning": "n√≥ng (th·ªùi ti·∫øt)", "lesson": 6 },
            { "id": "v602", "hiragana": "„Åï„ÇÄ„ÅÑ", "meaning": "l·∫°nh (th·ªùi ti·∫øt)", "lesson": 6 },
            { "id": "v603", "hiragana": "„ÅÇ„Åü„Åü„Åã„ÅÑ", "meaning": "·∫•m √°p", "lesson": 6 },
            { "id": "v604", "hiragana": "„Åô„Åö„Åó„ÅÑ", "meaning": "m√°t m·∫ª", "lesson": 6 },
            { "id": "v605", "hiragana": "„Åä„Åä„ÅÑ", "meaning": "ƒë√¥ng / nhi·ªÅu", "lesson": 6 },
            { "id": "v606", "hiragana": "„Åç„Åõ„Å§", "meaning": "m√πa", "lesson": 6 },
            { "id": "v607", "hiragana": "„ÅØ„Çã", "meaning": "m√πa xu√¢n", "lesson": 6 },
            { "id": "v608", "hiragana": "„Å™„Å§", "meaning": "m√πa h·∫°", "lesson": 6 },
            { "id": "v609", "hiragana": "„ÅÇ„Åç", "meaning": "m√πa thu", "lesson": 6 },
            { "id": "v610", "hiragana": "„Åµ„ÇÜ", "meaning": "m√πa ƒë√¥ng", "lesson": 6 },
            { "id": "v611", "hiragana": "„Åõ„Åã„ÅÑ", "meaning": "th·∫ø gi·ªõi", "lesson": 6 },
            { "id": "v612", "hiragana": "„Å°„Å°", "meaning": "b·ªë (m√¨nh)", "lesson": 6 },
            { "id": "v613", "hiragana": "„Åä„Å®„ÅÜ„Åï„Çì", "meaning": "b·ªë (ng∆∞·ªùi kh√°c)", "lesson": 6 },
            { "id": "v614", "hiragana": "„ÅØ„ÅØ", "meaning": "m·∫π (m√¨nh)", "lesson": 6 },
            { "id": "v615", "hiragana": "„Åä„Åã„ÅÇ„Åï„Çì", "meaning": "m·∫π (ng∆∞·ªùi kh√°c)", "lesson": 6 },
            { "id": "v616", "hiragana": "„Å©„Å°„Çâ", "meaning": "b√™n n√†o / ph√≠a n√†o", "lesson": 6 },
            { "id": "v617", "hiragana": "„Åª„ÅÜ", "meaning": "ph√≠a (so s√°nh)", "lesson": 6 },
            { "id": "v618", "hiragana": "„ÅÑ„Å°„Å∞„Çì", "meaning": "nh·∫•t", "lesson": 6 },

            // --- B√ÄI 7 (Mong mu·ªën & Ngh·ªÅ nghi·ªáp) ---
            { "id": "v701", "hiragana": "„Åä„Çà„Åé„Åæ„Åô", "meaning": "b∆°i", "lesson": 7 },
            { "id": "v702", "hiragana": "„Åë„Å£„Åì„Çì„Åó„Åæ„Åô", "meaning": "k·∫øt h√¥n", "lesson": 7 },
            { "id": "v703", "hiragana": "„Çä„Çá„Åì„ÅÜ„Åó„Åæ„Åô", "meaning": "du l·ªãch", "lesson": 7 },
            { "id": "v704", "hiragana": "„ÇÑ„Åô„Åø„Åæ„Åô", "meaning": "ngh·ªâ ng∆°i", "lesson": 7 },
            { "id": "v705", "hiragana": "„Å™„Çä„Åæ„Åô", "meaning": "tr·ªü n√™n / tr·ªü th√†nh", "lesson": 7 },
            { "id": "v706", "hiragana": "„Åª„Åó„ÅÑ", "meaning": "mu·ªën (c√≥)", "lesson": 7 },
            { "id": "v707", "hiragana": "„Å§„ÇÅ„Åü„ÅÑ", "meaning": "l·∫°nh (c·∫£m gi√°c)", "lesson": 7 },
            { "id": "v708", "hiragana": "„ÅÇ„Åü„Çâ„Åó„ÅÑ", "meaning": "m·ªõi", "lesson": 7 },
            { "id": "v709", "hiragana": "„Éó„Éº„É´", "meaning": "b·ªÉ b∆°i", "lesson": 7 },
            { "id": "v710", "hiragana": "„Åã„Çè", "meaning": "s√¥ng", "lesson": 7 },
            { "id": "v711", "hiragana": "„ÅÜ„Åø", "meaning": "bi·ªÉn", "lesson": 7 },
            { "id": "v712", "hiragana": "„Å†„ÅÑ„Å®„ÅÜ„Çä„Çá„ÅÜ", "meaning": "t·ªïng th·ªëng", "lesson": 7 },
            { "id": "v713", "hiragana": "„Åã„Åó„ÇÖ", "meaning": "ca sƒ©", "lesson": 7 },
            { "id": "v714", "hiragana": "„É¢„Éá„É´", "meaning": "ng∆∞·ªùi m·∫´u", "lesson": 7 },
            { "id": "v715", "hiragana": "„Åó„ÇÉ„Å°„Çá„ÅÜ", "meaning": "gi√°m ƒë·ªëc", "lesson": 7 },

            // --- B√ÄI 8 (M·ª•c ƒë√≠ch ƒëi l·∫°i) ---
            { "id": "v801", "hiragana": "„ÅÇ„Åù„Å≥„Åæ„Åô", "meaning": "ch∆°i", "lesson": 8 },
            { "id": "v802", "hiragana": "„ÇÄ„Åã„Åà„Åæ„Åô", "meaning": "ƒë√≥n", "lesson": 8 },
            { "id": "v803", "hiragana": "„Å†„Åó„Åæ„Åô", "meaning": "g·ª≠i (th∆∞)", "lesson": 8 },
            { "id": "v804", "hiragana": "„Åï„Çì„ÅΩ„Åó„Åæ„Åô", "meaning": "ƒëi d·∫°o", "lesson": 8 },
            { "id": "v805", "hiragana": "„Åó„Çá„Åè„Åò„Åó„Åæ„Åô", "meaning": "d√πng b·ªØa", "lesson": 8 },
            { "id": "v806", "hiragana": "„Åã„ÅÑ„ÇÇ„ÅÆ„Åó„Åæ„Åô", "meaning": "mua s·∫Øm", "lesson": 8 },
            { "id": "v807", "hiragana": "„Å§„Çä", "meaning": "c√¢u c√°", "lesson": 8 },
            { "id": "v808", "hiragana": "„Çπ„Ç≠„Éº", "meaning": "tr∆∞·ª£t tuy·∫øt", "lesson": 8 },
            { "id": "v809", "hiragana": "„Åì„Å©„ÇÇ", "meaning": "tr·∫ª con", "lesson": 8 },
            { "id": "v810", "hiragana": "„Å≥„Åò„ÇÖ„Å§", "meaning": "m·ªπ thu·∫≠t", "lesson": 8 },
            { "id": "v811", "hiragana": "„Åë„ÅÑ„Åñ„ÅÑ", "meaning": "kinh t·∫ø", "lesson": 8 },
            { "id": "v812", "hiragana": "„Åà„Åç", "meaning": "nh√† ga", "lesson": 8 }
        ];

        const vocabulary = rawData.map(item => ({
            id: parseInt(item.id.replace('v', '')),
            jp: item.hiragana,
            vn: item.meaning,
            lesson: item.lesson,
            romaji: ""
        }));

        // --- STATE ---
        let currentQuestions = [];
        let currentIndex = 0;
        let score = 0;
        let isVnToJp = true;
        let isAnswered = false;
        let correctAnswer = null;
        let autoSkipTimer = null;

        // --- DOM ---
        const screenTopics = document.getElementById('screen-topics');
        const screenQuiz = document.getElementById('screen-quiz');
        const screenResult = document.getElementById('screen-result');
        const topicsList = document.getElementById('topics-list');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const btnNext = document.getElementById('btn-next');
        const scoreDisplay = document.getElementById('score-display');
        const progressDisplay = document.getElementById('progress-display');
        const finalScore = document.getElementById('final-score');
        const finalMsg = document.getElementById('final-msg');

        // --- INIT ---
        function init() {
            renderTopics();
            showTopics();
        }

        function renderTopics() {
            topicsList.innerHTML = '';

            // Find unique lessons
            const lessons = [...new Set(vocabulary.map(item => item.lesson))].sort((a, b) => a - b);

            // "All Topics" button
            const btnAll = document.createElement('button');
            btnAll.className = 'btn btn-topic';
            btnAll.innerHTML = `<span>üìö T·∫•t c·∫£ ch·ªß ƒë·ªÅ</span> <span>${vocabulary.length} t·ª´</span>`;
            btnAll.onclick = () => startQuiz('all');
            topicsList.appendChild(btnAll);

            // Lesson buttons
            lessons.forEach(lesson => {
                const count = vocabulary.filter(i => i.lesson === lesson).length;
                const btn = document.createElement('button');
                btn.className = 'btn btn-topic';
                btn.innerHTML = `<span>üìñ B√†i ${lesson}</span> <span>${count} t·ª´</span>`;
                btn.onclick = () => startQuiz(lesson);
                topicsList.appendChild(btn);
            });
        }

        function showTopics() {
            screenTopics.classList.add('active');
            screenQuiz.classList.remove('active');
            screenResult.classList.remove('active');
        }

        // --- GAME LOGIC ---

        function startQuiz(lesson) {
            // Read Mode
            const modeEls = document.getElementsByName('lang-mode');
            for (let m of modeEls) {
                if (m.checked) isVnToJp = (m.value === 'vn_jp');
            }

            // Filter Data
            let pool = [];
            if (lesson === 'all') {
                pool = [...vocabulary];
            } else {
                pool = vocabulary.filter(item => item.lesson === lesson);
            }

            if (pool.length === 0) {
                alert("Ch∆∞a c√≥ d·ªØ li·ªáu cho b√†i n√†y!");
                return;
            }

            // Shuffle all questions
            pool.sort(() => Math.random() - 0.5);
            currentQuestions = pool; // Use all questions instead of limiting to 10

            // Reset State
            currentIndex = 0;
            score = 0;

            // Show Quiz Screen
            screenTopics.classList.remove('active');
            screenResult.classList.remove('active');
            screenQuiz.classList.add('active');

            loadQuestion();
        }

        function loadQuestion() {
            // Clear any pending auto-skip timer
            if (autoSkipTimer) {
                clearTimeout(autoSkipTimer);
                autoSkipTimer = null;
            }

            // Reset UI for new question
            isAnswered = false;
            btnNext.style.display = 'none';
            questionText.innerText = '';
            optionsContainer.innerHTML = '';

            // Update Stats
            scoreDisplay.innerText = `ƒêi·ªÉm: ${score}`;
            progressDisplay.innerText = `C√¢u: ${currentIndex + 1}/${currentQuestions.length}`;

            // Get Data
            const currentItem = currentQuestions[currentIndex];
            correctAnswer = currentItem;

            // Display Question
            // If VN->JP: Show Meaning
            // If JP->VN: Show Kanji (or Hiragana if Kanji same)
            if (isVnToJp) {
                questionText.innerText = currentItem.vn;
            } else {
                questionText.innerText = currentItem.jp;
            }

            // Generate Options (1 Correct + 3 Wrong)
            let options = [currentItem];

            // Pick 3 wrong answers from FULL DATA (to ensure variety even in small lessons)
            while (options.length < 4) {
                const randomItem = vocabulary[Math.floor(Math.random() * vocabulary.length)];
                // Ensure unique and not the correct answer
                if (!options.find(o => o.id === randomItem.id)) {
                    options.push(randomItem);
                }
            }

            // Shuffle Options
            options.sort(() => Math.random() - 0.5);

            // Render Buttons
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';

                // If VN->JP: Options are JP (Kanji/Hiragana)
                // If JP->VN: Options are Meaning
                if (isVnToJp) {
                    btn.innerText = opt.jp;
                    // Add sub-text for hiragana if kanji is main? Maybe later. For now simple.
                } else {
                    btn.innerText = opt.vn;
                }

                btn.onclick = () => handleAnswer(opt, btn);
                optionsContainer.appendChild(btn);
            });
        }

        function handleAnswer(selected, btn) {
            if (isAnswered) return;
            isAnswered = true;

            if (selected.id === correctAnswer.id) {
                btn.classList.add('correct');
                score += 10;
                scoreDisplay.innerText = `ƒêi·ªÉm: ${score}`;
                btnNext.style.display = 'block';

                // Auto-skip to next question after 1.5 seconds
                autoSkipTimer = setTimeout(() => {
                    nextQuestion();
                }, 1500);
            } else {
                btn.classList.add('wrong');
                // Highlight correct answer
                const allBtns = optionsContainer.querySelectorAll('.option-btn');
                allBtns.forEach(b => {
                    const txt = isVnToJp ? correctAnswer.jp : correctAnswer.vn;
                    if (b.innerText === txt) {
                        b.classList.add('correct');
                    }
                });

                // Auto-reset after 1 second without alert
                autoSkipTimer = setTimeout(() => {
                    // Re-shuffle questions for variety each restart
                    currentQuestions.sort(() => Math.random() - 0.5);
                    // Reset to beginning
                    currentIndex = 0;
                    score = 0;
                    loadQuestion();
                }, 1000);
            }
        }

        function nextQuestion() {
            currentIndex++;
            if (currentIndex < currentQuestions.length) {
                loadQuestion();
            } else {
                finishGame();
            }
        }

        function finishGame() {
            screenQuiz.classList.remove('active');
            screenResult.classList.add('active');
            finalScore.innerText = score;

            const maxScore = currentQuestions.length * 10;
            const ratio = score / maxScore;

            if (ratio === 1) finalMsg.innerText = "Tuy·ªát v·ªùi! B·∫°n ƒë√£ thu·ªôc h·∫øt r·ªìi! üåü";
            else if (ratio >= 0.8) finalMsg.innerText = "R·∫•t t·ªët! C·ªë g·∫Øng th√™m ch√∫t n·ªØa! üí™";
            else if (ratio >= 0.5) finalMsg.innerText = "T·∫°m ƒë∆∞·ª£c, c·∫ßn √¥n luy·ªán th√™m nh√©! üìö";
            else finalMsg.innerText = "C·ªë l√™n! ƒê·ª´ng b·ªè cu·ªôc! üî•";
        }

        // Start
        init();

    </script>
</body>

</html>
